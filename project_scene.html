<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Project Scene</title>
    <link href="./css/styles.css" rel="stylesheet" type="text/css">
    <style>
        canvas {
            display: block;
            margin: 10px auto;
            width: 100%;
            height: 100%;
        }
    </style>

    <script src="./js/three.js"></script>
    <script src="./js/OrbitControls.js"></script>
    <script src="./js/tw.js"></script>
    <script src="./js/SceneUtils.js"></script>
</head>

<body>
    <h1>Project Scene</h1>
    <script>
        // ================================================================
        // Add Global Parameters:

        var plainParams = {
            width: 30,
            height: 30,
            wSegments: 10, // width segments
            hSegments: 10, // height segments
        }
        var deathStarParams = {
            // Outer shell (hull):
            hullRadius: 10,
            hullWSegments: 32,
            hullHSegments: 16,
            hullThetaStart: 0.3,
            // cannon:
            //cannonThetaStart: -0.3,
            cannonThetaLength: -0.3, // Inverse of the theta start on the hull.
            //cannonThetaLength: -Math.PI * 4,
        }

        // ================================================================
        // Add materials:

        var sceneMaterials = [
            // Material for Tatooine's desert floor.
            new THREE.MeshBasicMaterial({
                color: new THREE.Color("tan"), // color
                side: THREE.DoubleSide, // sides
            }),
            // Material for the death-star frame ("hull").
            new THREE.MeshBasicMaterial({
                color: new THREE.Color("darkgrey"), // color
                side: THREE.SingleSide, // sides: show outside surface
            }),
            // Material for the concave sphere / cannon of the Death Star
            new THREE.MeshBasicMaterial({
                color: new THREE.Color("grey"),
                side: THREE.DoubleSide,
            }),
        ];

        // ================================================================
        // Add functions:
        // ----------------------------------------------------------------
        // Object functions ( lights, meshes, etc. ):
        
        /**
         * MakePlain() creates a template plane geometry, which acts as the
         * desert floor of our scene.
         */
        function makePlain() {

            var params = plainParams;

            var plainGeom = new THREE.PlaneGeometry( 
                params.width,
                params.height,
                params.wSegments,
                params.hSegments,
            );
            var plainMesh = new THREE.Mesh( plainGeom, sceneMaterials[0] );
            // Adjust plain as needed:
            plainMesh.rotation.set( (Math.PI/2), 0, 0 );
            // Return the completed plain:
            return plainMesh;
        }

        /**
         * function makeDeathStar() creates the death star, by generating
         * a new Object3D and calling sub-functions to add meshes into it.
         */
        function makeDeathStar(){

            var params = deathStarParams;

            var deathStar = new THREE.Object3D();

            // Add Death Star hull:
            var hullGeom = new THREE.SphereGeometry( 
                params.hullRadius, // radius
                params.hullWSegments, // width segments
                params.hullHSegments, // height segments
                0, // phiStart ( default )
                (Math.PI * 2), //phiLength ( default )
                params.hullThetaStart, // thetaStart: controls hole in the sphere.
                Math.PI, // thetaLength ( default )
            );
            var hullMesh = new THREE.Mesh( hullGeom, sceneMaterials[1] );

            // Add Death Star cannon:
            var cannonGeom = new THREE.SphereGeometry(
                params.hullRadius, // radius
                params.hullWSegments, // width segments
                params.hullHSegments, // height segments
                0, // phiStart ( default )
                (Math.PI * 2), //phiLength ( default )
                0, // thetaStart (default )
                params.cannonThetaLength, // thetaLength: controls where sphere
                                          // starts generating length-wise.
            );
            var cannonMesh = new THREE.Mesh( cannonGeom, sceneMaterials[2] );
            // Adjust cannon position:
            cannonMesh.position.set( 0, (params.hullRadius * 1.911), 0);
            cannonMesh.rotation.set( 0, 0, Math.PI); // Rotate the cannon 180 degrees.

            // combine meshes into the death star:
            deathStar.add( hullMesh );
            deathStar.add( cannonMesh );

            return deathStar;
        }

        

        // ----------------------------------------------------------------
        // GUI / animation functions:

        /**
         * updateDeathStar() takes the parameters for the Death Star's
         * position and updates them, then re-renders the scene accordingly.
         * This will be used for animation purposes.
         */
        function updateDeathStar() {

            
            //deathStar.rotation.set( 0, 0, (Math.PI/3) );
            deathStar.position.set( 0, 20, 0);
            deathStar.lookAt( 0, 0, 0);
        }

        // ================================================================
        //                 BUILD SCENE:
        // ================================================================
        
        var scene = new THREE.Scene();

        var desert = makePlain();
        scene.add(desert);

        var deathStar = makeDeathStar();
        //scene.add(deathStar);

        //updateDeathStar();

        // ================================================================
        // Add renderer:

        var renderer = new THREE.WebGLRenderer();

        TW.mainInit(renderer, scene); // TODO: Change from TW

        // ================================================================
        // Add camera setup:

        var state = TW.cameraSetup(renderer,
            scene,
            {
                minx: -10, maxx: 10,
                miny: 0, maxy: 10,
                minz: -10, maxz: 10
            });
        
        state.axisHelper.visible = true;
        TW.render();

        // ================================================================
        // Add GUI:





    </script>
</body>

</html>